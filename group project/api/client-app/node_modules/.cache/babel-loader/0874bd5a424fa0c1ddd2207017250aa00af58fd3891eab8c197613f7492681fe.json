{"ast":null,"code":"// src/context/AuthContext.jsx\nimport React,{createContext,useEffect,useState}from'react';import axios from'axios';import{useNavigate}from'react-router-dom';import{jwtDecode}from'jwt-decode';import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();// Function to get the decoded token\nexport const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const navigate=useNavigate();useEffect(()=>{const token=localStorage.getItem(\"token\");if(token){axios.defaults.headers.common['Authorization']='Bearer '+token;setUser({token});}setLoading(false);},[]);const getDecodedToken=()=>{const token=localStorage.getItem(\"token\");if(token){try{return jwtDecode(token);}catch(error){console.log(\"Failed to decode token:\",error);}}return null;// Return null if there is no valid token\n};const login=async(username,password)=>{try{const response=await axios.post(\"/api/auth/login\",{username,password});const token=response.data.token;console.log(\"response \"+response);console.log(\"response.data \"+response.data);console.log(\"response.data.token \"+response.data.token);console.log(\"token: \"+token);if(!token||typeof token!==\"string\"){throw new Error(\"Invalid token format\");}localStorage.setItem(\"token\",token);axios.defaults.headers.common['Authorization']='Bearer '+token;setUser({token});// Decode the token to get user claims\nconst decodedToken=jwtDecode(token);console.log(\"token: \"+decodedToken);const isAdmin=decodedToken.IsAdmin===\"true\";console.log(\"token: \"+isAdmin);if(isAdmin){navigate(\"/admin-dashboard\");}else{navigate(\"/user-dashboard\");}}catch(error){console.log(\"Login Failed: \",error);}};// Function to log out\nconst logout=()=>{localStorage.removeItem('token');delete axios.defaults.headers.common['Authorization'];setUser(null);navigate('/login');// Redirect to login page after logout\n};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,login,logout,loading,getDecodedToken},children:children});};","map":{"version":3,"names":["React","createContext","useEffect","useState","axios","useNavigate","jwtDecode","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","loading","setLoading","navigate","token","localStorage","getItem","defaults","headers","common","getDecodedToken","error","console","log","login","username","password","response","post","data","Error","setItem","decodedToken","isAdmin","IsAdmin","logout","removeItem","Provider","value"],"sources":["C:/Users/sigur/OneDrive/Skrivebord/Test/Solution2/api/client-app/src/context/AuthContext.jsx"],"sourcesContent":["// src/context/AuthContext.jsx\r\nimport React, {createContext, useEffect, useState} from 'react';\r\nimport axios from 'axios';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { jwtDecode } from 'jwt-decode';\r\n\r\n\r\n\r\nexport const AuthContext = createContext();\r\n\r\n// Function to get the decoded token\r\n\r\n\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n    const [user, setUser] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const navigate = useNavigate();\r\n    \r\n    useEffect(() => {\r\n        const token = localStorage.getItem(\"token\");\r\n        if (token) {\r\n            axios.defaults.headers.common['Authorization'] = 'Bearer ' + token;\r\n            \r\n            setUser({token});\r\n        }\r\n        setLoading(false);\r\n    }, []);\r\n\r\n     const getDecodedToken = () => {\r\n        const token = localStorage.getItem(\"token\");\r\n        if (token) {\r\n            try {\r\n                return jwtDecode(token);\r\n            } catch (error) {\r\n                console.log(\"Failed to decode token:\", error);\r\n            }\r\n        }\r\n        return null; // Return null if there is no valid token\r\n    };\r\n    \r\n    const login = async (username, password) => {\r\n        try {\r\n            const response = await axios.post(\"/api/auth/login\", {\r\n                username,\r\n                password,\r\n            });\r\n            \r\n            const token = response.data.token;\r\n            \r\n            console.log(\"response \"+response)\r\n            console.log(\"response.data \"+response.data)\r\n            console.log(\"response.data.token \"+response.data.token)\r\n\r\n            console.log(\"token: \"+ token)\r\n\r\n\r\n\r\n            if (!token || typeof token !== \"string\") {\r\n                throw new Error(\"Invalid token format\");\r\n            }\r\n\r\n\r\n            localStorage.setItem(\"token\", token);\r\n            axios.defaults.headers.common['Authorization'] = 'Bearer ' + token;\r\n            setUser({token});\r\n\r\n            // Decode the token to get user claims\r\n            const decodedToken = jwtDecode(token);\r\n            \r\n            console.log(\"token: \" + decodedToken)\r\n\r\n            const isAdmin = decodedToken.IsAdmin === \"true\";\r\n            \r\n            console.log(\"token: \" + isAdmin)\r\n\r\n            \r\n\r\n            if (isAdmin) {\r\n                navigate(\"/admin-dashboard\");\r\n            } else\r\n            {\r\n                navigate(\"/user-dashboard\");\r\n            }\r\n            \r\n        }catch(error) {\r\n            console.log(\"Login Failed: \", error);\r\n        }\r\n        \r\n    }\r\n    // Function to log out\r\n    const logout = () => {\r\n        localStorage.removeItem('token');\r\n        delete axios.defaults.headers.common['Authorization'];\r\n        setUser(null);\r\n        navigate('/login'); // Redirect to login page after logout\r\n    };\r\n\r\n\r\n\r\n    \r\n    \r\n    \r\n    \r\n    return (\r\n        <AuthContext.Provider value={{ user, login, logout, loading, getDecodedToken  }}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n"],"mappings":"AAAA;AACA,MAAO,CAAAA,KAAK,EAAGC,aAAa,CAAEC,SAAS,CAAEC,QAAQ,KAAO,OAAO,CAC/D,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,SAAS,KAAQ,YAAY,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAIvC,MAAO,MAAM,CAAAC,WAAW,cAAGR,aAAa,CAAC,CAAC,CAE1C;AAIA,MAAO,MAAM,CAAAS,YAAY,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CACrC,KAAM,CAACE,IAAI,CAAEC,OAAO,CAAC,CAAGX,QAAQ,CAAC,IAAI,CAAC,CACtC,KAAM,CAACY,OAAO,CAAEC,UAAU,CAAC,CAAGb,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAAAc,QAAQ,CAAGZ,WAAW,CAAC,CAAC,CAE9BH,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAgB,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAIF,KAAK,CAAE,CACPd,KAAK,CAACiB,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,CAAG,SAAS,CAAGL,KAAK,CAElEJ,OAAO,CAAC,CAACI,KAAK,CAAC,CAAC,CACpB,CACAF,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAE,EAAE,CAAC,CAEL,KAAM,CAAAQ,eAAe,CAAGA,CAAA,GAAM,CAC3B,KAAM,CAAAN,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAIF,KAAK,CAAE,CACP,GAAI,CACA,MAAO,CAAAZ,SAAS,CAACY,KAAK,CAAC,CAC3B,CAAE,MAAOO,KAAK,CAAE,CACZC,OAAO,CAACC,GAAG,CAAC,yBAAyB,CAAEF,KAAK,CAAC,CACjD,CACJ,CACA,MAAO,KAAI,CAAE;AACjB,CAAC,CAED,KAAM,CAAAG,KAAK,CAAG,KAAAA,CAAOC,QAAQ,CAAEC,QAAQ,GAAK,CACxC,GAAI,CACA,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAA3B,KAAK,CAAC4B,IAAI,CAAC,iBAAiB,CAAE,CACjDH,QAAQ,CACRC,QACJ,CAAC,CAAC,CAEF,KAAM,CAAAZ,KAAK,CAAGa,QAAQ,CAACE,IAAI,CAACf,KAAK,CAEjCQ,OAAO,CAACC,GAAG,CAAC,WAAW,CAACI,QAAQ,CAAC,CACjCL,OAAO,CAACC,GAAG,CAAC,gBAAgB,CAACI,QAAQ,CAACE,IAAI,CAAC,CAC3CP,OAAO,CAACC,GAAG,CAAC,sBAAsB,CAACI,QAAQ,CAACE,IAAI,CAACf,KAAK,CAAC,CAEvDQ,OAAO,CAACC,GAAG,CAAC,SAAS,CAAET,KAAK,CAAC,CAI7B,GAAI,CAACA,KAAK,EAAI,MAAO,CAAAA,KAAK,GAAK,QAAQ,CAAE,CACrC,KAAM,IAAI,CAAAgB,KAAK,CAAC,sBAAsB,CAAC,CAC3C,CAGAf,YAAY,CAACgB,OAAO,CAAC,OAAO,CAAEjB,KAAK,CAAC,CACpCd,KAAK,CAACiB,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,CAAG,SAAS,CAAGL,KAAK,CAClEJ,OAAO,CAAC,CAACI,KAAK,CAAC,CAAC,CAEhB;AACA,KAAM,CAAAkB,YAAY,CAAG9B,SAAS,CAACY,KAAK,CAAC,CAErCQ,OAAO,CAACC,GAAG,CAAC,SAAS,CAAGS,YAAY,CAAC,CAErC,KAAM,CAAAC,OAAO,CAAGD,YAAY,CAACE,OAAO,GAAK,MAAM,CAE/CZ,OAAO,CAACC,GAAG,CAAC,SAAS,CAAGU,OAAO,CAAC,CAIhC,GAAIA,OAAO,CAAE,CACTpB,QAAQ,CAAC,kBAAkB,CAAC,CAChC,CAAC,IACD,CACIA,QAAQ,CAAC,iBAAiB,CAAC,CAC/B,CAEJ,CAAC,MAAMQ,KAAK,CAAE,CACVC,OAAO,CAACC,GAAG,CAAC,gBAAgB,CAAEF,KAAK,CAAC,CACxC,CAEJ,CAAC,CACD;AACA,KAAM,CAAAc,MAAM,CAAGA,CAAA,GAAM,CACjBpB,YAAY,CAACqB,UAAU,CAAC,OAAO,CAAC,CAChC,MAAO,CAAApC,KAAK,CAACiB,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,CACrDT,OAAO,CAAC,IAAI,CAAC,CACbG,QAAQ,CAAC,QAAQ,CAAC,CAAE;AACxB,CAAC,CAQD,mBACIT,IAAA,CAACC,WAAW,CAACgC,QAAQ,EAACC,KAAK,CAAE,CAAE7B,IAAI,CAAEe,KAAK,CAAEW,MAAM,CAAExB,OAAO,CAAES,eAAiB,CAAE,CAAAZ,QAAA,CAC3EA,QAAQ,CACS,CAAC,CAE/B,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}